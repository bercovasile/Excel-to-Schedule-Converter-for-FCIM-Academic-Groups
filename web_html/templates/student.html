<!DOCTYPE html>
<html lang="en">
<head>
<title>CSS Template</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

<script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>
<style>
  
* {
  box-sizing: border-box;
}

body {
  font-family: Arial, Helvetica, sans-serif;
}

/* Style the header */
header {
  background-color: #666;
  padding: 10px;
  height: 100px;
  color: white;

}

/* Container for flexboxes */


/* Style the navigation menu */


/* Style the footer */
footer {
  background-color: #777;
  padding: 10px;
  text-align: center;
  color: white;
}
#myDiv {
  width: 100px;
  height: 100px;
  background-color: red;
  display: none; /* IniÈ›ial div-ul este invizibil */
}

/* test dart8*/
select {
   -webkit-appearance:none;
   -moz-appearance:none;
   -ms-appearance:none;
   appearance:none;
   outline:0;
   box-shadow:none;
   border:0!important;
   background: #5c6664;
   background-image: none;
   flex: 1;
   padding: 0 .5em;
   color:#fff;
   cursor:pointer;
   font-size: 1em;
   font-family: 'Open Sans', sans-serif;
}
select::-ms-expand {
   display: none;
}
.select {
   position: relative;
   display: flex;
   width: 15em;
   height: 3em;
   line-height: 3;
   background: #5c6664;
   overflow: hidden;
   border-radius: .25em;
}
.select::after {
   content: '\25BC';
   position: absolute;
   top: 0;
   right: 0;
   padding: 0 .8em;
   background: #2b2e2e;
   cursor:pointer;
   pointer-events:none;
   transition:.25s all ease;
}
.select:hover::after {
   color: #23b499;
}

/* div box */
.select_box{
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  background-color: red;
}


aside{
  padding: 10px;
}

/* Responsive layout - makes the menu and the content (inside the section) sit on top of each other instead of next to each other */
@media (max-width: 600px) {
  section {
    -webkit-flex-direction: column;
    flex-direction: column;
  }
  header{
    height: 200px;
  }
  .test_table{
                width: 100%;
                border-collapse:;
                
  }
  .test_tr {
                display: block;
                margin-bottom: 10px;
                text-align: center;
                flex-direction: row;
                justify-content: center;
                align-items: center;
                background-color: blue;
            }
            
            .test_td {
                display: block;
                width: 100%;
                padding: 20px;
                flex-direction: row;
  justify-content: center;
  align-items: center;
                background-color: yellow;
              
            }
  
}
</style>



</head>
<body>

<header>
  <div class="select_box">
    <table class="test_table" >
      <tr class="test_tr" >
          <td class="test_td">
            <div class="select_box">
              <section>
                  <div class="select">
                    <select id="selectOptions" onchange="updateSecondComboBox()" name="format"  > 
                        <option>-- Anul --</option>
                        <option value="Anul 1">Anul 1</option>
                        <option value="Anul 2">Anul 2</option>
                        <option value="Anul 3">Anul 3</option>
                        <option value="Anul 4">Anul 4</option>
                    </select>
                  </div>
                </section>
            </div>
          </td>
          <td class="test_td">
            <div class="select_box">
              <section>
                <div class="select">
                  <select id="selectOptionsGrups" onchange="sendSelectedOptionGrups()" name="format"> 
                    <option>-- Grupa --</option>
                  </select>
                </div>  
              </section>
            </div>
              
          </td>
     
      </tr>
    </table>
  </div>

</header>


<aside>
  <div class="select_box">
     <div id="excel_data" class="mt-5"></div>
  </div> 
    
    
    
</aside>


<footer>
  <p>Footer</p>


</footer>
<script>

  function updateSecondComboBox() {
    const selectOptions = document.getElementById("selectOptions");
    const selectedOption = selectOptions.value;

    const selectOptionsGrups = document.getElementById("selectOptionsGrups");

    fetch("/get_options_grups", {
        method: "POST", // sau "GET" Ã®n funcÈ›ie de necesitÄƒÈ›i
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({ selectedOption }),
    })
    .then(response => response.json())
    .then(data => {
        // È˜tergeÈ›i opÈ›iunile actuale din al doilea combobox
        selectOptionsGrups.innerHTML = "";

        // AdÄƒugaÈ›i opÈ›iunile noi Ã®n al doilea combobox
        data.options.forEach(option => {
            const optionElement = document.createElement("option");
            optionElement.textContent = option;
            optionElement.value = option;
            selectOptionsGrups.appendChild(optionElement);
        });
    })
    .catch(error => {
        console.error("Error updating second combobox:", error);
    });
}

  function sendSelectedOptionGrups() {
      const selectOptionsGrups = document.getElementById("selectOptionsGrups");
      const selectedOptionGrups = selectOptionsGrups.value; // ObÈ›ineÈ›i valoarea opÈ›iunii selectate
      // TrimiteÈ›i opÈ›iunea aleasÄƒ cÄƒtre backend folosind o cerere AJAX
      fetch("/handle_selected_option_grups", {
        method: "POST", // sau "GET" Ã®n funcÈ›ie de necesitÄƒÈ›i
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ selectedOptionGrups }),
      })
        .then(response => response.blob())
        .then(blob => {
         
        excel_to_html_table_4(blob);
          

          
        })
        .catch(error => {
          console.error("Error sending selected option:", error);
        });
  }


function excel_to_html_table_4(excel_blob) {
  var reader = new FileReader();
  reader.onload = function(event) {
    var data = new Uint8Array(event.target.result);
    var workbook = XLSX.read(data, { type: "array" });
    var sheet_name = workbook.SheetNames[0];
    var sheet_data = XLSX.utils.sheet_to_json(workbook.Sheets[sheet_name], { header: 1 });

    
    if (sheet_data.length > 0) {
      var table_output = '<table class="listViewTable table-sortable" id="listViewTable" border=1px >';
      for (var row = 0; row < sheet_data.length; row=row+2) {
        var merge_data='';
        table_output += '<tr class="ce1 colorYellow">';

        for (var cell = 0; cell < sheet_data[row].length; cell++) {
          // VerificÄƒm dacÄƒ valoarea este undefined È™i o Ã®nlocuim cu un spaÈ›iu gol
          var cellValue = sheet_data[row][cell] === undefined ?" " : sheet_data[row][cell];
          
          if (row == 0) {
            table_output += '<th class="name1 hsText">' + cellValue + '</th>';
          } else {
           
            if (sheet_data[row+1][cell]!== undefined){

              var undefinedCellValue =cellValue=== '.'? "ðŸ“–":cellValue;
              table_output += '<td class="entry1 hsText">' + undefinedCellValue + '</td>';

              var mergeCell=sheet_data[row+1][cell] === '.' ?"ðŸ“–" : sheet_data[row+1][cell];
              merge_data += '<td class="entry1 hsText">' + mergeCell + '</td>';

            }else{
              var undefinedCellValue =cellValue=== '.'? "ðŸ“–":cellValue;
              table_output += '<td class="entry1 hsText" rowspan="2">' + undefinedCellValue + '</td>';
            }
          }
        }
        table_output += '</tr>';
        if (merge_data==='')
         table_output += '<tr></tr>';
        else
           table_output += '<tr>'+merge_data+'</tr>';
      }
      table_output += '</table>';
      document.getElementById('excel_data').innerHTML = table_output;
    }
  };

  reader.readAsArrayBuffer(excel_blob);
}




</script>
</body>
</html>

